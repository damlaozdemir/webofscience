(dp1
S'output'
p2
S"<type 'exceptions.NameError'> global name 'Math' is not defined"
p3
sS'layer'
p4
S'/home/damla/web2py/applications/webofscience/controllers/default.py'
p5
sS'code'
p6
S'from urllib2 import *\nimport urllib\nimport collections\nimport itertools\nfrom gluon.serializers import json\nimport math\n\n\'\'\'def cache_in_ram():\n    import time\n    t=cache.ram(\'time\',lambda:time.ctime(),time_expire=5)\n    return dict(time=t,link=A(\'click to reload\',_href=URL(r=request)))\'\'\'\ndef index():\n    session.keyword = str(request.vars.inputkeyword)\n    if(session.keyword == "None"):\n        session.keyword = "*"\n    else:\n        session.keyword = str(request.vars.inputkeyword)\n    \n    f = { \'q\' : session.keyword}\n\n    connection = urlopen(\'http://localhost:8983/solr/webofscienceindex/select?\'+urllib.urlencode(f)+\'&rows=20&wt=json&indent=true&facet=true&facet.field=authors&facet.field=published&facet.mincount=1&facet.limit=20\')\n    response = eval(connection.read())\n\n    articles = response[\'response\'][\'docs\']\n    facet = response[\'facet_counts\'][\'facet_fields\']\n    \n    authorArticles =[]\n    totalArticles = []\n    facetList =[]\n    for f in facet[\'authors\']:\n        if(facet[\'authors\'].index(f) %2 == 0):\n            authorArticles.append(f)\n        else:\n            totalArticles.append(f)\n    facetList.append(authorArticles)\n    facetList.append(totalArticles)\n    length = len(facetList[0])\n    """\n    print "-------------------------------------------------"\n    for author in facetList[0]:\n        print author\n        f = { \'q\' : session.keyword, \'fq\' : "authors:"+author}\n        connection2 = urlopen(\'http://localhost:8983/solr/webofscienceindex/select?\'+urllib.urlencode(f)+\'&rows=20000&wt=json&indent=true&facet=true&facet.field=authors&facet.field=published&facet.mincount=1&facet.limit=100\')\n        \n        response = eval(connection2.read())\n        articles2 = response[\'response\'][\'docs\']\n        \n        \n        for article in articles2:\n            for author in article[\'authors\']:\n                index=article[\'authors\'].index(author)\n            pass\n           \n            if \'revisedAddress\' in article :\n              if len(article[\'revisedAddress\'])>= index+1:\n                print article[\'revisedAddress\'][index][4:-4] \n                break\n              else:\n                continue\n            else:\n            \n                for address in article[\'address\']:\n                    \n                    print address[5:-2]\n\n                pass\n\n            pass\n        pass\n        """\n    \n    #Autocomplete#\n    uniquekeywords = []\n    for article in articles:\n        keywords = []\n        if \'keywords\' in article :\n            for keyword in article[\'keywords\']:\n                keywords.append(keyword.lower())\n        keywordsplus = []\n        if \'keywordsplus\' in article :\n            for keywordplus in article[\'keywordsplus\']:\n                keywordsplus.append(keywordplus.lower())\n        totalkeywords = itertools.chain(keywords, keywordsplus)\n        for keywords in totalkeywords:\n            uniquekeywords.append(keywords)\n        keywordcomplete = json(set(uniquekeywords))\n\n    #Pagination\n    T = len(facetList[0]) # not sure where your data comes from, or if you have to process a query first...\n    P = request.vars.page # e.g. http://blah.com/show_items?page=0\n    i = request.vars.ipp # e.g. http://blah.com/show_items?page=0&ipp=50\n\n    #now the code from before...\n    num_pages = Math.Ceil( T / I ) # ceil(100/10) = 10 pages\n    cur_page = P # 0\n\n    start = I*P # 10 * 0 = 0\n    end = start + ipp # 0 + 10 = 10\n    if end > total: # false\n      end = total\n\n    items = allitems[start:end] # this page\'s items\n    return dict(keyword =session.keyword, facetList=facetList, length = length,  articles=articles, keywordcomplete = json(set(uniquekeywords)), data=items,\n      start=start,\n      end=end,\n      total=total, prev=page-1 if page > 0 else None,next=page+1 if page < num_pages else None)\n\ndef author():\n\n    keyword2 = session.keyword\n    \n    authorrequest = request.args[0]\n    authorname = authorrequest.replace(\'__\', \', \')\n    athname = session.authorname\n    cot = ("\\"","\\"")\n    authorname = authorname.join(cot)\n\n    f = { \'q\' : keyword2, \'fq\' : "authors:"+authorname}\n    urlname = urllib.urlencode(f)\n    connection = urlopen(\'http://localhost:8983/solr/webofscienceindex/select?\'+urllib.urlencode(f)+\'&rows=200000&wt=json&indent=true&facet=true&facet.field=authors&facet.field=published&facet.mincount=1&facet.limit=100\')\n    response = eval(connection.read())\n    matches = response[\'response\'][\'numFound\']\n    articles = response[\'response\'][\'docs\']\n    facet = response[\'facet_counts\'][\'facet_fields\']\n    #articles = sorted(articles, key=lambda k: k [\'published\'][0], reverse= True)\n    articlesList = []\n    puclisheddates = []\n    for a in articles:\n        article = {}\n        #p = a[\'published\'][0]\n        #new[\'published\'] = p\n        #article[\'authors\'] = a[0][0]\n        article[\'title\'] = a[\'title\'][0]\n        #article[\'abstract\'] = a[2][0]\n        #article[\'keywords\'] = a[\'keywords\'][0]\n        #article[\'address\'] = a[\'revisedAddress\'][0]\n        #dates.append(d)\n        articlesList.append(article)\n    #dates = list(set(dates)) # coklu degerleri uniqe yapar\n    length = len(articlesList[0])\n\n    years =[]\n    numofpub = []\n    facetListyears =[]\n    facetList =[]\n    for f in facet[\'published\']:\n        if(facet[\'published\'].index(f) %2 == 0):\n            years.append(f[-4:])\n        else:\n            numofpub.append(f)\n    facetListyears.append(years)\n    facetListyears.append(numofpub)\n    #lengthofyears = len(facetList[0])\n    mydict = {}\n    for i in range(len(facetListyears[0])):\n        if facetListyears[0][i] in mydict:\n            mydict[facetListyears[0][i]] += facetListyears[1][i]\n        else:\n            mydict[facetListyears[0][i]] = facetListyears[1][i]\n    \n    mydict = collections.OrderedDict(sorted(mydict.items()))\n    return dict(articlesList = articlesList, articles=articles, keyword =keyword2, matches=matches,urlname=urlname,authorname=authorname,length=length, athname=athname ,facetListyears=facetListyears, mydict=mydict)\n\nresponse._vars=response._caller(index)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "/home/damla/web2py/gluon/restricted.py", line 227, in restricted\n    exec ccode in environment\n  File "/home/damla/web2py/applications/webofscience/controllers/default.py", line 164, in <module>\n  File "/home/damla/web2py/gluon/globals.py", line 417, in <lambda>\n    self._caller = lambda f: f()\n  File "/home/damla/web2py/applications/webofscience/controllers/default.py", line 94, in index\n    num_pages = Math.Ceil( T / I ) # ceil(100/10) = 10 pages\nNameError: global name \'Math\' is not defined\n'
p11
s.